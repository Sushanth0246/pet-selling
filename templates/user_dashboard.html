{% extends 'base.html' %}
{% block title %}My Dashboard - PetSelling{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <!-- Dashboard Header -->
    <div class="dashboard-hero">
        <div class="hero-content">
            <h1>Welcome Back!</h1>
            <p class="hero-subtitle">Explore available pets, manage your requests, and view your adoption history</p>
        </div>
        <div class="hero-stats">
            <div class="stat-card">
                <span class="stat-number">{{ pets|length }}</span>
                <span class="stat-label">Available Pets</span>
            </div>
            <div class="stat-card">
                <span class="stat-number">{{ pending|length }}</span>
                <span class="stat-label">Pending Requests</span>
            </div>
            <div class="stat-card">
                <a href="{{ url_for('user_payments') }}" style="display:block; color:inherit; text-decoration:none;">
                    <span class="stat-number">{{ pending_payments or 0 }}</span>
                    <span class="stat-label">Payments Pending</span>
                </a>
            </div>
            <div class="stat-card">
                <span class="stat-number">{{ history|length }}</span>
                <span class="stat-label">Purchased</span>
            </div>
        </div>
    </div>

    <!-- Available Pets Section -->
    <section class="dashboard-section">
        <div class="section-header">
            <div>
                <h2>Available Pets</h2>
                <p>Browse and request pets for adoption</p>
            </div>
        </div>

        {% if pets %}
            <div class="pets-grid">
                {% for pet in pets %}
                    <div class="pet-card">
                        <div class="pet-image-wrapper">
                            {% if pet.ImageURL %}
                                <img src="{{ pet.ImageURL }}" alt="{{ pet.Name }}" class="pet-image" onerror="this.src='/static/images/no-image.png'">
                            {% else %}
                                <div class="pet-image-placeholder">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="8" r="4"></circle>
                                        <path d="M12 14c-4 0-6 3-6 3v5h12v-5s-2-3-6-3z"></path>
                                    </svg>
                                </div>
                            {% endif %}
                            <div class="pet-type-badge">{{ pet.Type or 'Pet' }}</div>
                        </div>

                        <div class="pet-body">
                            <h3 class="pet-name">{{ pet.Name or 'Unnamed' }}</h3>
                            
                            <div class="pet-owner-info">
                                <span class="owner-label">Owner:</span>
                                <span class="owner-name">{{ pet.OwnerName or '—' }}</span>
                            </div>

                            <div class="pet-meta">
                                <span class="meta-item">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M6 9l6-7 6 7M3 8h18v13a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8z"></path>
                                    </svg>
                                    {{ pet.Breed or 'N/A' }}
                                </span>
                                <span class="meta-item">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                    {{ pet.Age or '0' }} yrs
                                </span>
                                <span class="meta-item">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 5v14M5 12h14"></path>
                                    </svg>
                                    {{ pet.Gender or 'N/A' }}
                                </span>
                            </div>

                            {% if pet.Description %}
                                <p class="pet-description">{{ pet.Description[:80] }}{% if pet.Description|length > 80 %}...{% endif %}</p>
                            {% endif %}

                            <div class="pet-price">${{ "%.2f"|format(pet.Price or 0) }}</div>

                            <div class="pet-actions">
                                <a href="{{ url_for('pet_detail', pet_id=pet.PetID) }}" class="btn btn-outline">
                                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    View
                                </a>
                                <form action="{{ url_for('adopt', pet_id=pet.PetID) }}" method="POST" style="margin:0;">
                                    <button type="submit" class="btn btn-primary">
                                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                                        </svg>
                                        Request
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="16"></line>
                    <line x1="8" y1="12" x2="16" y2="12"></line>
                </svg>
                <h3>No Pets Available</h3>
                <p>Check back soon for new pets to adopt!</p>
            </div>
        {% endif %}
    </section>

    <!-- Pending Requests Section (Cart-like) -->
    <section class="dashboard-section">
        <div class="section-header">
            <div>
                <h2>Pending Requests</h2>
                <p>Adoption requests awaiting owner approval</p>
            </div>
        </div>

        {% if pending %}
            <div class="requests-list">
                {% for req in pending %}
                    <div class="request-item">
                        <div class="request-image">
                            {% if req.ImageURL %}
                                <img src="{{ req.ImageURL }}" alt="{{ req.PetName }}" onerror="this.src='/static/images/no-image.png'">
                            {% else %}
                                <div class="request-image-placeholder">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="8" r="4"></circle>
                                        <path d="M12 14c-4 0-6 3-6 3v5h12v-5s-2-3-6-3z"></path>
                                    </svg>
                                </div>
                            {% endif %}
                        </div>

                        <div class="request-info">
                            <div class="request-header">
                                <h3 class="request-name">{{ req.PetName }}</h3>
                                <span class="detail-badge">Pending</span>
                            </div>
                            
                            <div class="request-meta">
                                <span class="meta-small">
                                    <strong>Type:</strong> {{ req.Type or '—' }} • <strong>Breed:</strong> {{ req.Breed or '—' }}
                                </span>
                                <span class="meta-small">
                                    <strong>Age:</strong> {{ req.Age or '—' }} yrs • <strong>Gender:</strong> {{ req.Gender or '—' }}
                                </span>
                            </div>

                            <div class="request-details">
                                <div class="detail-col">
                                    <span class="detail-label">Requested on:</span>
                                    <span class="detail-value">{{ req.CreatedAt.strftime('%b %d, %Y') if req.CreatedAt else '—' }}</span>
                                </div>
                                <div class="detail-col">
                                    <span class="detail-label">Adoption Fee:</span>
                                    <span class="detail-value price-value">${{ "%.2f"|format(req.Price or 0) }}</span>
                                </div>
                                <div class="detail-col">
                                    <span class="detail-label">Owner:</span>
                                    <span class="detail-value">{{ req.OwnerName or '—' }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="request-actions">
                            <a href="{{ url_for('pet_detail', pet_id=req.PetID) }}" class="btn btn-outline" title="View full details">View</a>
                            <form action="{{ url_for('cancel_request', req_id=req.ReqID) }}" method="POST" style="width: 100%;" onsubmit="return confirm('Cancel this adoption request?')">
                                <button type="submit" class="btn btn-danger" title="Cancel request">Cancel</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <h3>No Pending Requests</h3>
                <p>You haven't requested any pets yet. Scroll up to request a pet!</p>
            </div>
        {% endif %}
    </section>

    <!-- Purchase History Section -->
    <section class="dashboard-section">
        <div class="section-header">
            <div>
                <h2>Purchase History</h2>
                <p>Your completed adoptions and payments</p>
            </div>
        </div>

        {% if history %}
            <div class="history-list">
                {% for h in history %}
                    <div class="history-item">
                        <div class="history-image">
                            {% if h.ImageURL %}
                                <img src="{{ h.ImageURL }}" alt="{{ h.PetName }}" onerror="this.src='/static/images/no-image.png'">
                            {% else %}
                                <div class="history-image-placeholder">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="8" r="4"></circle>
                                        <path d="M12 14c-4 0-6 3-6 3v5h12v-5s-2-3-6-3z"></path>
                                    </svg>
                                </div>
                            {% endif %}
                        </div>

                        <div class="history-info">
                            <h3 class="history-name">{{ h.PetName }}</h3>
                            
                            <div class="history-details">
                                <div class="detail-row">
                                    <span class="detail-label">Breed & Type:</span>
                                    <span class="detail-value">{{ h.Breed or '—' }} • {{ h.Type or '—' }}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Owner:</span>
                                    <span class="detail-value">{{ h.OwnerName or '—' }}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Payment Date:</span>
                                    <span class="detail-value">{{ h.PaymentDate.strftime('%b %d, %Y') if h.PaymentDate else '—' }}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Amount Paid:</span>
                                    <span class="detail-value amount">${{ "%.2f"|format(h.Price or h.Amount or 0) }}</span>
                                </div>
                            </div>

                            <div class="history-status">
                                <span class="status-badge status-success">✓ Completed</span>
                            </div>
                        </div>

                        <div class="history-actions">
                            <a href="{{ url_for('pet_detail', pet_id=h.PetID) }}" class="btn btn-outline">View Pet</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <h3>No Purchase History</h3>
                <p>You haven't completed any adoptions yet. Start by requesting a pet!</p>
            </div>
        {% endif %}
    </section>
</div>

<style>
    :root {
        --primary: #667eea;
        --accent: #764ba2;
        --success: #27ae60;
        --danger: #e74c3c;
        --warning: #f39c12;
        --info: #3498db;
        --bg: #f6f8fb;
        --card: #ffffff;
        --text: #17202a;
        --text-light: #5a6c7d;
        --border: #ecf0f1;
        --shadow: 0 6px 18px rgba(23, 32, 42, 0.08);
        --shadow-sm: 0 2px 8px rgba(23, 32, 42, 0.05);
        --radius: 12px;
        --radius-sm: 8px;
    }

    .dashboard-wrapper {
        animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .dashboard-hero {
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        border-radius: var(--radius);
        padding: 40px;
        color: white;
        margin-bottom: 40px;
        box-shadow: var(--shadow);
    }

    .hero-content h1 { margin: 0 0 8px 0; font-size: 2.2em; text-shadow: 2px 2px 4px rgba(0,0,0,.2); }
    .hero-subtitle { margin:0; font-size:1.05em; opacity:.95; }

    .hero-stats { display: grid; grid-template-columns: repeat(auto-fit,minmax(150px,1fr)); gap:20px; margin-top:30px; }

    .stat-card {
        background: rgba(255,255,255,0.15); backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2); padding:20px; border-radius:var(--radius-sm); text-align:center;
        transition: all .3s ease;
    }
    .stat-card:hover { transform: translateY(-3px); background: rgba(255,255,255,0.25); }

    .stat-number { display:block; font-size:2.2em; font-weight:700; margin-bottom:6px; }
    .stat-label { display:block; font-size:.9em; opacity:.9; }

    .dashboard-section {
        background: var(--card); border-radius: var(--radius); padding:30px; margin-bottom:30px; box-shadow:var(--shadow);
        animation: slideUp .4s ease;
    }
    @keyframes slideUp { from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }

    .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:25px; gap:20px; flex-wrap:wrap; }
    .section-header h2 { margin:0; font-size:1.6em; color:var(--text); }
    .section-header p { margin:6px 0 0 0; color:var(--text-light); font-size:.95em; }

    .pets-grid { display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:20px; }

    .pet-card { background:var(--card); border:1px solid var(--border); border-radius:var(--radius-sm); overflow:hidden; transition:all .3s ease; display:flex; flex-direction:column; height:100%; }
    .pet-card:hover { border-color:var(--primary); box-shadow:0 8px 25px rgba(102,126,234,0.15); transform:translateY(-5px); }

    .pet-image-wrapper { position:relative; width:100%; height:200px; background:linear-gradient(135deg,#f5f7fa,#c3cfe2); overflow:hidden; }
    .pet-image { width:100%; height:100%; object-fit:cover; transition:transform .3s ease; }
    .pet-card:hover .pet-image { transform:scale(1.08); }
    .pet-image-placeholder { width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#95a5a6; }
    .pet-image-placeholder svg { width:60px; height:60px; opacity:.5; }

    .pet-type-badge { position:absolute; top:12px; right:12px; background:linear-gradient(135deg,var(--primary),var(--accent)); color:white; padding:6px 12px; border-radius:20px; font-size:.8em; font-weight:600; text-transform:uppercase; }

    .pet-body { padding:16px; flex-grow:1; display:flex; flex-direction:column; }
    .pet-name { margin:0 0 6px 0; font-size:1.3em; color:var(--text); }
    .pet-owner-info { display:flex; align-items:center; gap:6px; font-size:.85em; margin-bottom:8px; padding-bottom:8px; border-bottom:1px solid var(--border); }
    .owner-label { color:var(--text-light); font-weight:600; }
    .owner-name { color:var(--primary); font-weight:600; }

    .pet-meta { display:flex; flex-direction:column; gap:8px; margin-bottom:10px; }
    .meta-item { display:flex; align-items:center; gap:6px; font-size:.85em; color:var(--text-light); }
    .meta-item svg { width:16px; height:16px; flex-shrink:0; }

    .pet-description { font-size:.85em; color:var(--text-light); margin:8px 0; line-height:1.4; }
    .pet-price { font-size:1.4em; font-weight:700; color:var(--success); margin-bottom:12px; }

    .pet-actions { display:flex; gap:8px; margin-top:auto; }

    .requests-list { display:flex; flex-direction:column; gap:15px; }
    .request-item { display:flex; align-items:flex-start; gap:16px; padding:16px; background:linear-gradient(135deg,rgba(102,126,234,0.02),rgba(118,75,162,0.02)); border:1px solid var(--border); border-radius:var(--radius-sm); transition:all .3s ease; }
    .request-item:hover { border-color:var(--primary); box-shadow:0 4px 12px rgba(102,126,234,0.1); }
    .request-image { width:80px; height:80px; border-radius:8px; overflow:hidden; flex-shrink:0; }
    .request-image img { width:100%; height:100%; object-fit:cover; }
    .request-image-placeholder { width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#95a5a6; }
    .request-image-placeholder svg { width:28px; height:28px; opacity:.6; }

    .request-info { flex-grow:1; }
    .request-header { display:flex; align-items:center; gap:12px; margin-bottom:8px; }
    .request-name { margin:0; font-size:1.15em; color:var(--text); }
    .request-meta { display:flex; flex-direction:column; gap:6px; margin-bottom:10px; padding-bottom:10px; border-bottom:1px solid var(--border); }
    .meta-small { font-size:.85em; color:var(--text-light); }
    .request-details { display:grid; grid-template-columns: repeat(auto-fit,minmax(120px,1fr)); gap:12px; margin-bottom:10px; }

    .detail-col { display:flex; flex-direction:column; gap:4px; }
    .detail-label { font-size:.75em; font-weight:600; text-transform:uppercase; color:var(--text-light); letter-spacing:.5px; }
    .detail-value { font-size:.95em; color:var(--text); font-weight:500; }
    .price-value { font-size:1.1em; color:var(--success); font-weight:700; }
    .detail-badge { display:inline-block; background:rgba(243,156,18,0.1); color:var(--warning); padding:4px 10px; border-radius:12px; font-size:.75em; font-weight:600; text-transform:uppercase; }

    .request-actions { display:flex; gap:8px; flex-shrink:0; flex-direction:column; min-width:100px; }

    .history-list { display:flex; flex-direction:column; gap:15px; }
    .history-item { display:flex; align-items:flex-start; gap:16px; padding:16px; background:linear-gradient(135deg,rgba(39,174,96,0.02),rgba(46,204,113,0.02)); border:1px solid var(--border); border-radius:var(--radius-sm); transition:all .3s ease; }
    .history-item:hover { border-color:var(--success); box-shadow:0 4px 12px rgba(39,174,96,0.1); }
    .history-image { width:100px; height:100px; border-radius:var(--radius-sm); overflow:hidden; flex-shrink:0; }
    .history-image img { width:100%; height:100%; object-fit:cover; }
    .history-image-placeholder { width:100%; height:100%; background:linear-gradient(135deg,#f5f7fa,#c3cfe2); display:flex; align-items:center; justify-content:center; color:#95a5a6; }
    .history-image-placeholder svg { width:40px; height:40px; opacity:.5; }

    .history-info { flex-grow:1; }
    .history-name { margin:0 0 10px 0; font-size:1.15em; color:var(--text); }
    .history-details { display:grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap:12px; margin-bottom:10px; }
    .detail-row { display:flex; flex-direction:column; gap:4px; }
    .detail-value.amount { font-size:1.1em; color:var(--success); font-weight:700; }
    .detail-value.status { color:var(--success); font-weight:600; }
    .history-status { display:flex; gap:8px; }
    .status-badge { display:inline-block; padding:4px 10px; border-radius:12px; font-size:.75em; font-weight:600; text-transform:uppercase; }
    .status-success { background:rgba(39,174,96,0.1); color:var(--success); }

    .history-actions { flex-shrink:0; }

    .empty-state { text-align:center; padding:60px 40px; }
    .empty-icon { width:80px; height:80px; color:#bdc3c7; margin:0 auto 20px; opacity:.6; }
    .empty-state h3 { margin:0 0 10px 0; font-size:1.3em; color:var(--text); }
    .empty-state p { margin:0 0 20px 0; color:var(--text-light); font-size:.95em; }

    .btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 16px; border:none; border-radius:var(--radius-sm); font-size:.9em; font-weight:600; cursor:pointer; text-decoration:none; transition:all .3s ease; white-space:nowrap; }
    .btn-icon { width:18px; height:18px; }
    .btn-primary { background:linear-gradient(135deg,var(--primary),var(--accent)); color:white; flex:1; }
    .btn-primary:hover { box-shadow:0 4px 12px rgba(102,126,234,0.4); transform:translateY(-2px); }
    .btn-outline { background:transparent; color:var(--primary); border:1.5px solid var(--border); flex:1; }
    .btn-outline:hover { border-color:var(--primary); background:rgba(102,126,234,0.05); }
    .btn-danger { background:rgba(231,76,60,0.1); color:var(--danger); border:1.5px solid var(--border); flex:1; }
    .btn-danger:hover { background:var(--danger); color:white; border-color:var(--danger); }

    @media (max-width:768px) {
        .dashboard-hero { padding:30px 20px; }
        .hero-content h1 { font-size:1.8em; }
        .hero-stats { grid-template-columns: repeat(3,1fr); gap:12px; margin-top:20px; }
        .stat-card { padding:15px; }
        .stat-number { font-size:1.8em; }
        .dashboard-section { padding:20px; }
        .section-header { flex-direction:column; align-items:flex-start; }
        .section-header h2 { font-size:1.3em; }
        .pets-grid { grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:15px; }
        .pet-image-wrapper { height:160px; }
        .request-item, .history-item { flex-direction:column; align-items:flex-start; }
        .request-image, .history-image { width:100%; height:200px; }
        .request-actions { width:100%; flex-direction:row; }
        .request-actions .btn { flex:1; }
        .history-details { grid-template-columns: 1fr 1fr; }
        .history-actions { width:100%; }
        .history-actions .btn { width:100%; }
    }

    @media (max-width:480px) {
        .dashboard-hero { padding:20px 15px; margin-bottom:25px; }
        .hero-content h1 { font-size:1.5em; }
        .hero-subtitle { font-size:.9em; }
        .hero-stats { grid-template-columns:1fr; gap:10px; margin-top:15px; }
        .dashboard-section { padding:15px; margin-bottom:20px; }
        .section-header h2 { font-size:1.2em; }
        .pets-grid { grid-template-columns:1fr; }
        .request-details { grid-template-columns:1fr; }
        .history-details { grid-template-columns:1fr; }
        .empty-state { padding:40px 20px; }
        .empty-icon { width:60px; height:60px; }
    }
</style>
{% endblock %}